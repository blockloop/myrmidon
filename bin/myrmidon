#!/usr/bin/env node

var lib = require('../lib/myrmidon.js');
var fs = require('fs');
var path = require('path');
var _ = require('lodash');
var util = require('../lib/utils');
var prompt = require('read');
var program = require('commander');
var colors = require('colors');

program
	.version(require('../package.json').version)
	.option('-c, --config', 'Specify a config file to use');


program
	.command('add-playlist [id]')
	.action(function(id, opts) {
		lib.playlistId(id);
	});

program
	.command('add-by-user [user]')
	.action(
		function (user) {
			if (!user) {
				console.error("Missing user parameter".red);
				process.exit(1);
			}
			lib.getFeedsForUser(user, function(items){
				console.log('Found '+ items.length +' playlists for '+ user);
				console.log('');

				_.forEach(items, function(item, i){
					console.log(i + ": " + item.title);
				});
				console.log('');

				prompt({prompt: 'Choose a playlist: '}, function(err, result){
					var choice = items[result];
					lib.addFeed(choice);
				});
			});
		});

program
	.command('*')
	.action(program.help);

program
	.parse(process.argv);